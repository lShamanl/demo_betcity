# Развертывание системы на сервер
## Инструкция
### Вводные
Итак, у Вас есть купленный сервер, логин и пароль для входа в консоль сервера.

### Создаем необходимые конфигурационные файлы
- на основе файла [hosts.yml.dist](hosts.yml.dist) создаем новый файл рядом, с названием "hosts.dist"
- заполняем целевой IP сервера

### Настраиваем доступы для управления целевым сервером
- Узнаем свой публичный ключ на локальном компьютере, копируем публичный ключ (все что вывелось)
```bash
cat ~/.ssh/id_rsa.pub
```
- Заходим любым удобным способом на целевой сервер
- Открываем следующий файл
```bash
nano ~/.ssh/authorized_keys
```
- Вставляем в него новой строкой скопированный публичный ключ

### (Опциональный шаг) Подготовка CI/CD
- Реализуйте файл [build.yml](../.github/workflows/build.yml) согласно вашему процессу
- Настройте docker-registry, чтобы образы приложения доставлялись в хранилище. Можно использовать бесплатный https://hub.docker.com/
- Залейте первый образ в docker-registry

### Выполните первый deploy кодовой базы на целевой сервер
- Скопируйте файл [.env.dist](../.deploy/.env.dist) в ../.deploy/.env, заполните его вашими данными
- Выполните следующие команды:
```bash
make generate-deploy-key
make authorize-deploy
make authorize
```
- Выполняем следующую команду из текущей директории
```bash
make app
```
- Выполните deploy:
```bash
cd ../.deploy && make -f Makefile deploy
```
